name: Go Packages

on:
  pull_request:
    branches: [main]
    paths:
      - .github/actions/build-go/**
      - .github/workflows/pkg.yml
      - pkg/**
  push:
    branches: [main]
    tags: ['v*.*.*']
    paths:
      - .github/actions/build-go/**
      - .github/workflows/pkg.yml
      - pkg/**

jobs:
  build-go:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        path:
          - pkg/broker
          - pkg/go
          - pkg/pcl
          - pkg/plugin
          - pkg/runner
          - pkg/uml
    steps:
      - uses: actions/checkout@v4

      - name: Make echo cli
        if: matrix.path == 'pkg/runner'
        run: make echo_cli

      - name: Build go
        uses: ./.github/actions/build-go
        with:
          lib: true
          path: ${{ matrix.path }}
          gomod: pkg/go.mod
